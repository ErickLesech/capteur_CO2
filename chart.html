<!DOCTYPE html>
<html lang="fr">
<head>
	<title>Test Chart.js</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
	<h1>chart</h1>
	<canvas id="myChart" width="600" height="400"></canvas>
	<script type='module'>

	//import firebase library

	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js"
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-analytics.js"
		// Import the functions you need from the SDKs you need
	import { getDatabase, ref, onValue, get, child } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js"

		const firebaseConfig = {
    		apiKey: "AIzaSyASUdodD9B57Pq5mgmArHja6ZGeRfcMvBs",
    		authDomain: "esp32project-c06f1.firebaseapp.com",
    		databaseURL: "https://esp32project-c06f1-default-rtdb.europe-west1.firebasedatabase.app",
    		projectId: "esp32project-c06f1",
    		storageBucket: "esp32project-c06f1.appspot.com",
    		messagingSenderId: "800242740503",
    		appId: "1:800242740503:web:3ab0cf75ba8420a84b1b52",
    		measurementId: "G-D8QC3SKVT4"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig)
  const analytics = getAnalytics(app)

  const db = getDatabase()
  console.log(db)

  var tab_co2 = []
  var tab_time = []

  var tempo

  get((child(ref(db),'Micro_11A'))).then((snapshot) => {
		  		if(snapshot.exists()){
		  			console.log(snapshot.val())
		  		}else {
   					 console.log("No data available")
  		}
		}).catch((error) => {
 		 console.error(error)
		});

let refMicro_11A = 'Micro_11A'

		get((child(ref(db),refMicro_11A))).then((snapshot) => {
			snapshot.forEach(function(childSnapshot){
				console.log("childsnapchot jour" + childSnapshot.val())
				if(childSnapshot.exists()){
					console.log("childsnapchot heure" + childSnapshot.val())

    					childSnapshot.forEach(function(childSnapshot){
							console.log("childsnapchot min" + childSnapshot.val())
							if(childSnapshot.exists()){
								//const childKey = childSnapshot.key + "";
    							//const childData = childSnapshot.val() + "";

    							childSnapshot.forEach(function(childSnapshot){

    								if(childSnapshot.exists()){
										tab_co2.push(childSnapshot.val().taux_de_CO2 + "")
    									tab_time.push(childSnapshot.val().time + "")
   
       			 						console.log("valeur tab_time : " + tab_time)
    			 						console.log("valeur tab_co2 : " + tab_co2)
    			 					
    			 					}else{
    			 						console.log("no data time and rate co2")
    			 					}
    			 				})

    						}else{

    							console.log("no min childsnapshot")
    						}
    					})

    				}else{
    					console.log("no hour exists")
    				}
    			})
		  		
		}).then(() =>{

			
				const ctx = document.getElementById('myChart').getContext('2d');
				const canva = document.getElementById('myChart');

				var gradienstroke = ctx.createLinearGradient(0, canva.width, 0, 0);

				gradienstroke.addColorStop(0, "#41fc03");
				gradienstroke.addColorStop(0.5, "#c9f005")
				gradienstroke.addColorStop(1, "#cf0617");


				var gradientfill = ctx.createLinearGradient(0, canva.width, 0, 0);

				gradientfill.addColorStop(0, "rgba(65, 252, 3, 0.5)");
				gradientfill.addColorStop(0.5, "rgba(201, 240, 5, 0.5)")

				gradientfill.addColorStop(1, "rgba(207, 6, 23,0.6)");

    			 console.log("dans then valeur tab_co2 : " + tab_co2)

    			 var delayBetweenPoints = 1000/tab_co2.length

				var data = {
					labels : tab_time,
					datasets : [{
						label : 'test courbe Micro_11A',
						backgroundColor : gradientfill,
						borderColor : gradienstroke,
						borderWidth : 4,
						radius : 1,
						data: tab_co2,
						fill : true,
				
					}],

					
				}

				var options = {
					responsive : false,
					plugins:{
						title:{
						 	display: true,
        					text: 'Chart of rate CO2 in Micro_11A'
        				}
        			}
				}

				var config = {
					type : 'line',
					data : data,
					options : options
					
				}

				const myChart = new Chart(ctx, config);


		})

	
		console.log("val fin de tab : " + tab_co2);

</script>

</body>
</html>
