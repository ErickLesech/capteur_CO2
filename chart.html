<!DOCTYPE html>
<html lang="fr">
<head>
	<title>Test Chart.js</title>
	<meta charset="utf-8">
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
	<h1>chart</h1>
	<canvas id="myChart" width="600" height="400"></canvas>
	<script type='module'>

	//import firebase library

	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js"
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-analytics.js"
		// Import the functions you need from the SDKs you need
	import { getDatabase, ref, onValue, get, child } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js"

		const firebaseConfig = {
    		apiKey: "AIzaSyASUdodD9B57Pq5mgmArHja6ZGeRfcMvBs",
    		authDomain: "esp32project-c06f1.firebaseapp.com",
    		databaseURL: "https://esp32project-c06f1-default-rtdb.europe-west1.firebasedatabase.app",
    		projectId: "esp32project-c06f1",
    		storageBucket: "esp32project-c06f1.appspot.com",
    		messagingSenderId: "800242740503",
    		appId: "1:800242740503:web:3ab0cf75ba8420a84b1b52",
    		measurementId: "G-D8QC3SKVT4"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig)
  const analytics = getAnalytics(app)

  const db = getDatabase()
  console.log(db)

  var tab_co2 = []
  var tab_time = []

  var tempo

  get((child(ref(db),'Micro_11A'))).then((snapshot) => {
		  		if(snapshot.exists()){
		  			console.log(snapshot.val())
		  		}else {
   					 console.log("No data available")
  		}
		}).catch((error) => {
 		 console.error(error)
		});

let refMin = 'Micro_11A'

		get((child(ref(db),refMin))).then((snapshot) => {
			snapshot.forEach(function(childSnapshot){
				console.log("childsnapchot jour" + childSnapshot.val())
				if(childSnapshot.exists()){
					console.log("childsnapchot heure" + childSnapshot.val())

    					childSnapshot.forEach(function(childSnapshot){
							console.log("childsnapchot min" + childSnapshot.val())
							if(childSnapshot.exists()){
								//const childKey = childSnapshot.key + "";
    							//const childData = childSnapshot.val() + "";

    							childSnapshot.forEach(function(childSnapshot){
									tab_co2.push(childSnapshot.val().taux_de_CO2 + "")
    								tab_time.push(childSnapshot.val().time + "")
   
       			 					console.log("valeur tab_time : " + tab_time)
    			 					console.log("valeur tab_co2 : " + tab_co2)
    			 					console.log(typeof childData)
    			 				})
    						}
    					})
    				}
    			})
		  		
		}).then(() =>{
				const ctx = document.getElementById('myChart').getContext('2d');

    			 console.log("dans then valeur tab_co2 : " + tab_co2)

				var data = {
					labels : tab_time,
					datasets : [{
						label : 'test courbe',
						backgroundColor : 'green',
						borderColor : 'green',
						borderWidth : 1,
						radius : 0,
						data: tab_co2
				
					}]
				}

				var options = {
					responsive : false,
				}

				var config = {
					type : 'line',
					data : data,
					options : options
				}

				const myChart = new Chart(ctx, config);


		})

	
		console.log("val fin de tab : " + tab_co2);

</script>

</body>
</html>
